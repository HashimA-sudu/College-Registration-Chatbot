<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Course Assistant — AI Chatbot</title>
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
  <main class="container" aria-live="polite">
    <header class="header">
      <div class="header-title">
        <br>
        <h1>KFU College Course Registration Chatbot</h1>
        <br>
      </div>
      <div class="header-actions">
        <a class="btn btn-ghost" href="index.html">Home</a>
        <a class="btn btn-ghost" href="login.html">Login</a>
      </div>
    </header>

     <div class="container">
                  <p class="muted"><span style="align-content: center;">Ask about courses, professors, and general information</span></p>
        <div class="header">
        </div>
        <div class="chat-window" id="chatWindow"></div>
        <div class="input-area">
            <input 
                type="text" 
                id="messageInput" 
                placeholder="Type your message..." 
                autocomplete="off">

            <button id="sendBtn">➤</button>
        </div>
    </div>

    <script>
        const chatWindow = document.getElementById('chatWindow');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');

        // Send message on button click
        sendBtn.addEventListener('click', sendMessage);

        // Send message on Enter key
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        async function sendMessage() {
            const message = messageInput.value.trim();

            if (!message) return;

            // Disable input and button
            messageInput.disabled = true;
            sendBtn.disabled = true;

            // Display user message
            addMessage(message, 'user');
            messageInput.value = '';

            // Show typing indicator
            showTypingIndicator();

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message })
                });

                if (!response.ok) {
                    throw new Error('Failed to send message');
                }

                const data = await response.json();
                removeTypingIndicator();
                addMessage(data.reply, 'bot');
            } catch (error) {
                removeTypingIndicator();
                addMessage('Sorry, an error occurred. Please try again.', 'bot');
                console.error('Error:', error);
            } finally {
                // Re-enable input and button
                messageInput.disabled = false;
                sendBtn.disabled = false;
                messageInput.focus();
            }
        }

        function addMessage(text, sender) {
            const messageEl = document.createElement('div');
            messageEl.className = `message ${sender}-message`;

            const contentEl = document.createElement('div');
            contentEl.className = 'message-content';
            contentEl.textContent = text;

            messageEl.appendChild(contentEl);
            chatWindow.appendChild(messageEl);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function showTypingIndicator() {
            const messageEl = document.createElement('div');
            messageEl.className = 'message bot-message';
            messageEl.id = 'typingIndicator';

            const typingEl = document.createElement('div');
            typingEl.className = 'typing-indicator';
            typingEl.innerHTML = '<span></span><span></span><span></span>';

            messageEl.appendChild(typingEl);
            chatWindow.appendChild(messageEl);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // Focus on input on page load
        messageInput.focus();
    </script>
    
    <footer class="footer">
      <div class="footer-info">
        <span class="muted">API: <code id="apiBase">http://localhost:3000</code></span>
      </div>
      <a class="btn btn-ghost" href="index.html">← Back to Home</a>
    </footer>
  </main>

  <script src="assets/js/chatbot.js"></script>
</body>
</html>